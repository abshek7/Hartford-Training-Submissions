<div class="min-h-screen bg-yellow-100">
  <!-- Header -->
  <div class="bg-green-500 border-b-4 border-black p-6 flex justify-between items-center">
    <h1 class="text-2xl font-extrabold">Author Dashboard</h1>

    <button class="bg-white border-4 border-black px-4 py-2 font-bold" (click)="signout()">
      Sign Out
    </button>
  </div>

  <div class="p-6 grid md:grid-cols-2 gap-6">
    <!-- CREATE / EDIT -->
    <div class="bg-white border-4 border-black p-4 shadow-[6px_6px_0px_black]">
      <h2 class="text-lg font-extrabold mb-3">
        {{ service.editingId() ? 'Edit Blog' : 'Create Blog' }}
      </h2>

      <input
        class="border-4 border-black p-2 w-full mb-2"
        placeholder="Title"
        [ngModel]="service.title()"
        (ngModelChange)="service.title.set($event)"
      />

      <textarea
        class="border-4 border-black p-2 w-full mb-2"
        placeholder="Content"
        [ngModel]="service.content()"
        (ngModelChange)="service.content.set($event)"
      >
      </textarea>

      <button
        class="bg-green-400 border-4 border-black px-4 py-2 font-bold"
        (click)="service.saveBlog()"
      >
        {{ service.editingId() ? 'Update' : 'Publish' }}
      </button>
    </div>

    <!-- BLOG LIST -->
    <div class="bg-white border-4 border-black p-4 shadow-[6px_6px_0px_black]">
      <h2 class="text-lg font-extrabold mb-3">Your Blogs</h2>

      @for (blog of service.blogs(); track blog.id) {
        <div class="border-4 border-black p-3 mb-4">
          <div class="flex justify-between">
            <h3 class="font-bold">{{ blog.title }}</h3>

            <button class="border px-2" (click)="service.toggle(service.openBlogs, blog.id)">
              {{ service.isOpen(service.openBlogs, blog.id) ? 'Close' : 'Open' }}
            </button>
          </div>

          @if (service.isOpen(service.openBlogs, blog.id)) {
            <p>{{ blog.content }}</p>

            <div class="flex gap-2 mt-2">
              <button class="bg-yellow-300 border px-2" (click)="service.editBlog(blog)">
                Edit
              </button>

              <button class="bg-red-400 border px-2" (click)="service.deleteBlog(blog.id)">
                Delete
              </button>
            </div>

            <!-- COMMENTS -->
            <button
              class="mt-3 border px-2"
              (click)="service.toggle(service.openComments, blog.id)"
            >
              Comments
            </button>

            @if (service.isOpen(service.openComments, blog.id)) {
              <div class="mt-3 ml-3">
                @for (comment of service.getComments(blog.id); track comment.id) {
                  <div class="border p-2 mb-2">
                    <p>{{ comment.message }}</p>
                    <p class="text-sm">By: {{ comment.author }}</p>

                    <button class="text-blue-600 text-sm" (click)="service.replyTo.set(comment.id)">
                      Reply
                    </button>

                    <!-- Reply box -->
                    @if (service.replyTo() === comment.id) {
                      <input
                        class="border p-1 w-full mt-2"
                        [ngModel]="service.replyText()"
                        (ngModelChange)="service.replyText.set($event)"
                      />

                      <button
                        class="border px-2 mt-1"
                        (click)="service.addReply(blog.id, comment.id)"
                      >
                        Send
                      </button>
                    }

                    <!-- Replies -->
                    <div class="ml-5 mt-2">
                      @for (reply of service.getReplies(comment.id); track reply.id) {
                        <div class="border p-1 mb-1">
                          <p>{{ reply.message }}</p>
                          <p class="text-xs">By: {{ reply.author }}</p>
                        </div>
                      }
                    </div>
                  </div>
                }

                <!-- Add Comment -->
                <input
                  class="border p-2 w-full"
                  placeholder="Write comment"
                  [ngModel]="service.commentText()"
                  (ngModelChange)="service.commentText.set($event)"
                />

                <button class="border px-2 mt-2" (click)="service.addComment(blog.id)">
                  Comment
                </button>
              </div>
            }
          }
        </div>
      }
    </div>
  </div>
</div>
