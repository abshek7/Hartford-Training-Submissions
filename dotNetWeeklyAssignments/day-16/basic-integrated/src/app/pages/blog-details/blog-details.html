@if (loading()) {
  <p class="text-gray-500 text-center mt-10">Loading blog...</p>
}

<div class="p-6 max-w-3xl mx-auto">
 
<div class="mb-4">
  <button
    (click)="goHome()"
    class="bg-black text-white px-4 py-2 rounded">
    Back to Blogs
  </button>
</div>

@if (blog(); as b) {

  <div class="bg-white shadow rounded p-6">

    <h1 class="text-3xl font-bold mb-2">{{ b.title }}</h1>
    <p class="text-gray-600 mb-6">{{ b.content }}</p>

    <h2 class="text-xl font-semibold mb-3">Comments</h2>

    @if (b.comments.length > 0) {

      @for (c of b.comments; track c.id) {

        @if (editingId() === c.id) {

          <div class="border p-3 rounded mb-2 bg-yellow-50">

            <input
              [ngModel]="editData().author"
              (ngModelChange)="editData.set({ ...editData(), author: $event })"
              class="border p-2 w-full mb-2 rounded"
            />

            <input
              [ngModel]="editData().message"
              (ngModelChange)="editData.set({ ...editData(), message: $event })"
              class="border p-2 w-full mb-2 rounded"
            />

            <div class="flex gap-2">
              <button
                (click)="saveEdit(c.id)"
                class="bg-black text-white px-2 py-1 rounded">
                Save
              </button>

              <button
                (click)="cancelEdit()"
                class="bg-black text-white px-2 py-1 rounded">
                Cancel
              </button>
            </div>

          </div>

        } @else {

          <div class="border p-3 rounded mb-2 bg-gray-50 flex justify-between items-center">

            <div>
              <p class="font-medium">{{ c.message }}</p>
              <small class="text-gray-500">{{ c.author }}</small>
            </div>

            <div class="flex gap-2">

              <button
                (click)="startEdit(c)"
                class="bg-black text-white px-2 py-1 rounded">
                Edit
              </button>

              <button
                (click)="deleteComment(c.id)"
                class="bg-black text-white px-2 py-1 rounded">
                Delete
              </button>

            </div>

          </div>

        }

      }

    } @else {

      <p class="text-gray-500">No comments yet</p>

    }

  </div>

  <div class="mt-6 bg-white p-4 shadow rounded">

    <h3 class="font-semibold mb-3">Add Comment</h3>

    <input
      [ngModel]="comment().author"
      (ngModelChange)="updateAuthor($event)"
      placeholder="Author"
      class="border p-2 w-full mb-2 rounded"
    />

    <input
      [ngModel]="comment().message"
      (ngModelChange)="updateMessage($event)"
      placeholder="Message"
      class="border p-2 w-full mb-3 rounded"
    />

    <button
      (click)="addComment()"
      [disabled]="!comment().author || !comment().message"
      class="bg-black disabled:bg-gray-400 text-white px-4 py-2 rounded">
      Add Comment
    </button>

  </div>

}

</div>
